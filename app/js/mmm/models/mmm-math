var Backbone = require('backbone');
var $ = require('jquery');
Backbone.$ = $;

var calcMMM = Backbone.Model.extend({
  defaults: {
    numbers:'' //save array here as an attribute of this model?
  },

  // var num = 0;
  // var mode = 0;
  // var sortArgs = [];
  // var sum = 0;
  // var modeMap = {};
  // var mostFrequentNum;
  // var numOccurrences = 0;
  // var midpoint = 0;

  csvToArray: function(numsWithCommas) {
    var array = numsWithCommas.split(',');
    return array;
  },

  sortByAscending: function(nums) {
    //sorting the array - the function(a,b) trick ensures 19999 doesn't come before 2
    //thanks http://www.sitepoint.com/javascript-array-sorting/ for the help
    sortedArray = nums.sort(function(a,b) {
      return a - b;
    });

    console.log("Sorted by ascending value array: " + sortedArray);
    return sortedArray;
  },

  sum: function(nums) {
    var sum = 0;
    for (i = 0; i < nums.length; i ++) {
      sum += Number(nums[i]);
    }
    return sum;
  },

  //*** MEAN *** Sum the numbers and divide by the quantity of numbers
  mean: function(csvNums) {
    var numArray = this.csvToArray(csvNums); //convert to array
    var sumNums = this.sum(numArray); //sum the numbers
    var mean = Math.floor(sumNums / (numArray.length - 2)); //round off the long decimal
    return mean;
  },


  //*** MEDIAN *** Sort into ascending order and return the number in the middle
  median: function(csvNums) {
    var numArray = this.csvToArray(csvNums); //convert to array
    var sortedArray = this.sortByAscending(numArray);

    midpoint = sortedArray.length / 2;
    //this conditional is for handling uneven-numbered arrays
    if (midpoint % 2 !== 0) {
      midpoint = Math.floor(midpoint);
    }
    var median = sortedArray[midpoint];
    return median;
  },


  //*** MODE *** The most frequently occurring number in the set, if there is one.
  mode: function(csvNums) {
    var numArray = this.csvToArray(csvNums); //convert to array
    var num = 0;
    var modeMap = {};
    var mostFrequentNum;
    var numOccurrences = 0;
    var mode = 0;
    //loop through the numbers array and build a map
    //the key is the number itself
    //the value is how many times that number is found in the array
    for (i = 0; i < numArray.length; i ++) {
      num = numArray[i];
      if (modeMap[num] == null) {
        modeMap[num] = 1;
      } else {
        modeMap[num]++;
        if (modeMap[num] > numOccurrences) {
          mode = num;
          numOccurrences = modeMap[num];
        }
      }
    }

    if (mode == 0) {
      mode = "NO MODE";
    }

    return mode;
  }

});

module.exports = calcMMM;

//put math.js functions as functions in here
//edit this.numbers
//make them properties of the model
//model.mean, model.mode, etc
